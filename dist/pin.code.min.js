"use strict";angular.module("pinCode",[]).directive("digitRestricted",["$timeout",function(a){function b(a){var b="";for(var c in a)b+=a[c];return b}return{restrict:"A",link:function(c,d,e){var j,k,f=parseInt(e.idx,10),g=c.$parent.numberOfDigits,h=c.$parent.hideInput,i=c.$parent.hideTimeout;angular.element(d).on("keydown",function(d){8===d.keyCode&&(c.$parent.digits[""+f]="",c.$parent.pin=b(c.$parent.digits),f>0&&a(function(){j=j||$("#pin-d-"+(f-1)),j.focus(),a(function(){j.select()},0)},0))}),angular.element(d).on("keypress",function(d){13==d.keyCode&&f===g-1&&b(c.$parent.digits).length===g&&"function"==typeof c.onEnter&&c.onEnter();var e=$(this),j=e.val();return" "===j&&(e.select(),j=""),0!==d.charCode&&(j+=String.fromCharCode(d.charCode)),!/^[0-9]$/.test(j)||j.length>1?void d.preventDefault():void(1===j.length&&(f<g-1&&a(function(){k=k||$("#pin-d-"+(f+1)),k.focus()},0),h&&(c.$parent.digits[""+f]=j,c.$parent.pin=b(c.$parent.digits),a(function(){c.$parent.inputs[""+f]=" "},i))))}),angular.element(d).on("click",function(){$(this).select()})}}}]),angular.module("pinCode").directive("pin",function(){return{restrict:"E",template:'<div ng-repeat="inputIdx in inputsIdxs"><input idx="{{inputIdx}}" id="pin-d-{{inputIdx}}" type="text" ng-model="inputs[inputIdx]" digit-restricted><span ng-show="inputs[inputIdx] == \' \'" ng-bind-html="hideSymbol"></span></div>',link:function(a,b,c){a.numberOfDigits=a.numberOfDigits||4,a.hideSymbol=a.hideSymbol||"&#9899;",a.hideInput=a.hideInput||!0,a.hideTimeout=a.hideTimeout||200,a.inputs={},a.digits={},a.inputsIdxs=[],a.pin=a.pin||"";for(var d=0;d<a.numberOfDigits;d++)a.inputsIdxs.push(""+d);a.$watch("pin",function(){a.pin||(a.inputs={},a.digits={})}),a.$on("focusPin",function(a,b){$("#pin-d-0").focus()})},scope:{numberOfDigits:"=digits",hideInput:"=?",hideTimeout:"=?",hideSymbol:"=?",pin:"=",onEnter:"&?"}}});